<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Notation Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
        }

        #main-container {
            display: none;
        }

        #login-container {
            text-align: center;
        }

        #canvas-wrapper {
            position: relative;
            border: 2px solid black;
            display: inline-block;
            resize: both;
            overflow: hidden;
            width: 800px;
            height: 400px;
        }

        #canvas {
            border: 1px solid black;
            background-color: #fff;
        }

        #bin {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            background-color: red;
            cursor: pointer;
            color: white;
            text-align: center;
            line-height: 40px;
            font-size: 24px;
            border-radius: 50%;
        }

        .note-buttons {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
        }

        .note-button-container {
            display: inline-block;
            position: relative;
            margin: 5px;
            cursor: pointer;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #eee;
        }

        .resize-handle {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 10px;
            height: 10px;
            background-color: black;
            cursor: se-resize;
        }

        .note-button-container button {
            background: none;
            border: none;
            font-size: inherit;
            cursor: pointer;
        }

        #resize-handle {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 10px;
            height: 10px;
            background: black;
            cursor: se-resize;
        }
    </style>
</head>

<body>
    <div id="login-container">
        <h1>Login</h1>
        <input type="text" id="username" placeholder="Username">
        <button id="login-btn">Login</button>
    </div>

    <div id="main-container">
        <div id="canvas-wrapper">
            <canvas id="canvas"></canvas>
            <div id="resize-handle"></div>
            <div id="bin">üóëÔ∏è</div>
        </div>

        <div class="note-buttons"></div>

        <select id="slot-select">
            <option value="slot1">Slot 1</option>
            <option value="slot2">Slot 2</option>
        </select>
        <button id="save-btn">Save</button>
        <button id="load-btn">Load</button>
        <button id="logout-btn">Logout</button>
    </div>

    <script>
        function resizeCanvas() {
            const canvasWrapper = document.getElementById('canvas-wrapper');
            const canvas = document.getElementById('canvas');
            canvas.width = canvasWrapper.clientWidth;
            canvas.height = canvasWrapper.clientHeight;
            drawNotes();
        }

        function drawStaff() {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            ctx.strokeStyle = '#000';
            const staffLines = 5;
            const lineSpacing = canvas.height / staffLines;
            for (let i = 0; i < staffLines; i++) {
                ctx.beginPath();
                ctx.moveTo(0, (i + 1) * lineSpacing);
                ctx.lineTo(canvas.width, (i + 1) * lineSpacing);
                ctx.stroke();
            }
        }

        function drawNotes() {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawStaff();
            notesArray.forEach(note => {
                ctx.font = `${note.size}px Arial`;
                ctx.fillText(note.text, note.x, note.y);
            });
        }

        function init() {
            resizeCanvas();
            drawStaff();
            document.querySelector('.note-buttons').innerHTML = '';
            const notes = ['ùÖü', 'ùÖ†', 'ùÖ°', 'ùÖ¢', 'ùÖ£', 'ùÖ§', 'ùÖ•', 'ùÖ¶', 'ùÖß', 'ùÑû', 'ùÑ¢', 'ùÑ°', 'ùÑ´', '‚ôØ', '‚ô≠',
                '‚ô™', '‚ô´', '‚ô¨', '‚ô©', 'ùÑ†', 'ùÑ™', 'ùÑÄ', 'ùÑÅ', 'ùÑ¥', 'ùÑµ', 'ùÑ∂', 'ùÑ∑', 'ùÑ∏', 'ùÑπ', 'ùÑ∫',
                'ùÑª', 'ùÑº', 'ùÑΩ', 'ùÑæ', 'ùÑø', 'ùÖÄ', 'ùÖÅ', 'ùÖÇ', 'ùÖÉ', 'ùÖÑ', 'ùÖÖ', 'ùÖÜ', 'ùÖá', 'ùÖà'];
            notes.forEach((note, index) => {
                const noteButton = document.createElement('div');
                noteButton.className = 'note-button-container';
                noteButton.innerHTML = `<button>${note}</button>`;
                noteButton.onclick = () => addNoteToCanvas(note);

                // Add resize handle to each button
                const resizeHandle = document.createElement('div');
                resizeHandle.className = 'resize-handle';
                noteButton.appendChild(resizeHandle);
                
                // Add event listeners for resizing
                resizeHandle.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    const startX = e.clientX;
                    const startY = e.clientY;
                    const startWidth = noteButton.offsetWidth;
                    const startHeight = noteButton.offsetHeight;

                    function onMouseMove(e) {
                        noteButton.style.width = `${startWidth + (e.clientX - startX)}px`;
                        noteButton.style.height = `${startHeight + (e.clientY - startY)}px`;
                    }

                    function onMouseUp() {
                        document.removeEventListener('mousemove', onMouseMove);
                        document.removeEventListener('mouseup', onMouseUp);
                    }

                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('mouseup', onMouseUp);
                });

                document.querySelector('.note-buttons').appendChild(noteButton);
            });
        }

        function addNoteToCanvas(note) {
            const canvas = document.getElementById('canvas');
            const rect = canvas.getBoundingClientRect();
            const newNote = {
                text: note,
                x: canvas.width / 2,
                y: canvas.height / 2,
                size: 40
            };
            notesArray.push(newNote);
            drawNotes();
        }

        let notesArray = [];
        let selectedNote = null;
        let isDragging = false;

        const canvas = document.getElementById('canvas');
        canvas.addEventListener('mousedown', function (e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            selectedNote = notesArray.find(note =>
                x >= note.x - note.size / 2 &&
                x <= note.x + note.size / 2 &&
                y >= note.y - note.size / 2 &&
                y <= note.y + note.size / 2
            );
            if (selectedNote) {
                isDragging = true;
                drawNotes();
            }
        });

        canvas.addEventListener('mousemove', function (e) {
            if (isDragging) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                selectedNote.x = x;
                selectedNote.y = y;
                drawNotes();
            }
        });

        canvas.addEventListener('mouseup', function () {
            isDragging = false;
        });

        document.getElementById('save-btn').addEventListener('click', function () {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                alert('You need to be logged in to save');
                return;
            }

            const selectedSlot = document.getElementById('slot-select').value;
            const userData = JSON.parse(localStorage.getItem('userData')) || {};
            userData[currentUser] = userData[currentUser] || {};
            userData[currentUser][selectedSlot] = notesArray;
            localStorage.setItem('userData', JSON.stringify(userData));
            alert('Saved successfully!');
        });

        document.getElementById('load-btn').addEventListener('click', function () {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                alert('You need to be logged in to load');
                return;
            }

            const selectedSlot = document.getElementById('slot-select').value;
            const userData = JSON.parse(localStorage.getItem('userData')) || {};
            notesArray = userData[currentUser] && userData[currentUser][selectedSlot] ? userData[currentUser][selectedSlot] : [];
            drawNotes();
        });

        document.getElementById('login-btn').addEventListener('click', function () {
            const username = document.getElementById('username').value;
            if (username) {
                localStorage.setItem('currentUser', username);
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('main-container').style.display = 'block';
                init();
            }
        });

        document.getElementById('logout-btn').addEventListener('click', function () {
            localStorage.removeItem('currentUser');
            document.getElementById('main-container').style.display = 'none';
            document.getElementById('login-container').style.display = 'block';
        });

        const resizeHandle = document.getElementById('resize-handle');
        resizeHandle.addEventListener('mousedown', (e) => {
            e.preventDefault();
            const startX = e.clientX;
            const startY = e.clientY;
            const startWidth = document.getElementById('canvas-wrapper').offsetWidth;
            const startHeight = document.getElementById('canvas-wrapper').offsetHeight;

            function onMouseMove(e) {
                document.getElementById('canvas-wrapper').style.width = `${startWidth + (e.clientX - startX)}px`;
                document.getElementById('canvas-wrapper').style.height = `${startHeight + (e.clientY - startY)}px`;
                resizeCanvas();
            }

            function onMouseUp() {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            }

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        });

        document.getElementById('bin').addEventListener('mousedown', function (e) {
            e.preventDefault();
            const bin = document.getElementById('bin');
            const startX = e.clientX;
            const startY = e.clientY;
            const startLeft = bin.offsetLeft;
            const startTop = bin.offsetTop;

            function onMouseMove(e) {
                bin.style.left = `${startLeft + (e.clientX - startX)}px`;
                bin.style.top = `${startTop + (e.clientY - startY)}px`;
            }

            function onMouseUp() {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            }

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        });

        // Initialize with user data if available
        window.onload = function () {
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('main-container').style.display = 'block';
                init();
            }
        };
    </script>
</body>

</html>
